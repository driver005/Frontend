<IfModule mod_mime.c>
  AddEncoding br .br
</IfModule>

<IfModule mod_rewrite.c>
  RewriteEngine On

  # Brotli support for HTML, JS, CSS
  RewriteCond %{HTTP:Accept-encoding} br
  RewriteCond %{REQUEST_FILENAME}.br -f
  RewriteRule ^(.*)$ $1.br [L]

  # Fallback to index.html for SPA routing
  RewriteCond %{REQUEST_FILENAME} !-f<IfModule mod_mime.c>
  AddEncoding br .br
</IfModule>
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.html [L]
</IfModule>

<IfModule mod_headers.c>
  # Proper content types for compressed files
  <FilesMatch "\.js\.br$">
    ForceType application/javascript
    Header set Content-Encoding br
  </FilesMatch>

  <FilesMatch "\.css\.br$">
    ForceType text/css
    Header set Content-Encoding br
  </FilesMatch>

  <FilesMatch "\.html\.br$">
    ForceType text/html
    Header set Content-Encoding br
  </FilesMatch>
</IfModule>
